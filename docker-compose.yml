version: "3.9"

services:
  app:
    build:
      context: .
      args:
        - DEV=true
    ports:
      - "8000:8000"
    volumes:
      - app:/app
    command: >
      sh -c "python manage.py wait_for_db &&
             python manage.py migrate &&
             python manage.py runserver 0.0.0.0:8000"
    environment:
      - DB_HOST=db
      - DB_NAME=devdb
      - DB_USER=devuser
      - DB_PASS=changeme
    #depends_on:
    #  - db

  #db:
  #  image: mysql:8
  #  ports:
  #    - "3306:3306"
  #  environment:
  #    - MYSQL_DATABASE='Rostro_DB',
  #    - MYSQL_USER='rostro_test'
  #    - MYSQL_PASSWORD='9vxL4_0pCa.58'
  #    - MYSQL_HOST='db-rostro-mysql.cvd6cndsisc1.us-east-1.rds.amazonaws.com'

volumes:
  dev-db-data:
  app:
